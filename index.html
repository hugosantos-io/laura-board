<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quadro da Laura</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: 'Comic Sans MS', sans-serif;
      background: #FFF9F0;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    h1 {
      margin-top: 20px;
      color: #444;
    }

    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid #eee;
      padding: 12px;
      font-size: 1.4em;
    }

    th {
      background: #FFE6E6;
    }

    td {
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .emoji {
      transition: transform 0.2s;
    }

    .emoji:hover {
      transform: scale(1.3);
    }

    .emoji-list {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
      opacity: 0;
      transform: scale(0.95);
      pointer-events: none;
      transition: opacity 0.25s, transform 0.25s;
    }
    .emoji-list.open {
      opacity: 1;
      transform: scale(1);
      pointer-events: auto;
    }

    .emoji-list img {
      width: 40px;
      height: 40px;
      padding: 5px;
      cursor: pointer;
      display: inline-block;
      transition: transform 0.2s;
    }

    .emoji-list img:hover {
      transform: scale(1.2);
    }

    td img {
      width: 30px;
      height: 30px;
      vertical-align: middle;
      transition: transform 0.3s;
    }
    .pop {
      animation: pop 0.4s;
    }
    @keyframes pop {
      0% { transform: scale(0.2); }
      60% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    /* Confetes */
    .confetti {
      position: fixed;
      top: 0;
      left: 0;
      pointer-events: none;
      width: 100vw;
      height: 100vh;
      z-index: 2000;
    }
    .confetti-piece {
      position: absolute;
      width: 12px;
      height: 18px;
      border-radius: 3px;
      opacity: 0.7;
    }

    .summary {
      font-size: 1.4em;
      margin-top: 30px;
    }

    .button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 1.2em;
      border: none;
      border-radius: 6px;
      background-color: #FFB6B9;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }

    .button:hover {
      background-color: #ff8a8d;
    }

    .highlight {
      animation: flash 0.6s ease;
    }

    @keyframes flash {
      0% { background-color: #d4edda; }
      100% { background-color: transparent; }
    }
  </style>
</head>
<body>
  <h1>Quadro da Laura ✨</h1>
  <table id="taskTable">
    <thead>
      <tr>
        <th>Tarefa</th>
        <th>Seg</th>
        <th>Ter</th>
        <th>Qua</th>
        <th>Qui</th>
        <th>Sex</th>
        <th>Sáb</th>
        <th>Dom</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="task-1" name="task-1">Escovar os dentes</td>
        <td id="cell-1-1" name="cell-1-1"></td>
        <td id="cell-1-2" name="cell-1-2"></td>
        <td id="cell-1-3" name="cell-1-3"></td>
        <td id="cell-1-4" name="cell-1-4"></td>
        <td id="cell-1-5" name="cell-1-5"></td>
        <td id="cell-1-6" name="cell-1-6"></td>
        <td id="cell-1-7" name="cell-1-7"></td>
      </tr>
      <tr>
        <td id="task-2" name="task-2">Arrumar mochila</td>
        <td id="cell-2-1" name="cell-2-1"></td>
        <td id="cell-2-2" name="cell-2-2"></td>
        <td id="cell-2-3" name="cell-2-3"></td>
        <td id="cell-2-4" name="cell-2-4"></td>
        <td id="cell-2-5" name="cell-2-5"></td>
        <td id="cell-2-6" name="cell-2-6"></td>
        <td id="cell-2-7" name="cell-2-7"></td>
      </tr>
      <tr>
        <td id="task-3" name="task-3">Fazer lição</td>
        <td id="cell-3-1" name="cell-3-1"></td>
        <td id="cell-3-2" name="cell-3-2"></td>
        <td id="cell-3-3" name="cell-3-3"></td>
        <td id="cell-3-4" name="cell-3-4"></td>
        <td id="cell-3-5" name="cell-3-5"></td>
        <td id="cell-3-6" name="cell-3-6"></td>
        <td id="cell-3-7" name="cell-3-7"></td>
      </tr>
      <tr>
        <td id="task-4" name="task-4">Ler livro</td>
        <td id="cell-4-1" name="cell-4-1"></td>
        <td id="cell-4-2" name="cell-4-2"></td>
        <td id="cell-4-3" name="cell-4-3"></td>
        <td id="cell-4-4" name="cell-4-4"></td>
        <td id="cell-4-5" name="cell-4-5"></td>
        <td id="cell-4-6" name="cell-4-6"></td>
        <td id="cell-4-7" name="cell-4-7"></td>
      </tr>
      <tr>
        <td id="task-5" name="task-5">Ser gentil</td>
        <td id="cell-5-1" name="cell-5-1"></td>
        <td id="cell-5-2" name="cell-5-2"></td>
        <td id="cell-5-3" name="cell-5-3"></td>
        <td id="cell-5-4" name="cell-5-4"></td>
        <td id="cell-5-5" name="cell-5-5"></td>
        <td id="cell-5-6" name="cell-5-6"></td>
        <td id="cell-5-7" name="cell-5-7"></td>
      </tr>
    </tbody>
    <tfoot>
      <tr id="dailyPointsRow">
        <td><strong>Pontos do dia</strong></td>
        <td id="dp-1">0</td>
        <td id="dp-2">0</td>
        <td id="dp-3">0</td>
        <td id="dp-4">0</td>
        <td id="dp-5">0</td>
        <td id="dp-6">0</td>
        <td id="dp-7">0</td>
      </tr>
    </tfoot>
  </table>

  <div class="summary">
    Pontos da semana: <span id="weeklyPoints">0</span>
  </div>

  <button class="button" onclick="resetBoard()">Resetar semana</button>
  <button class="button" onclick="exportData()">Exportar semana</button>

  <audio id="sound-happy" src="assets/sounds/moods/happy.mp3" preload="auto"></audio>
  <audio id="sound-good" src="assets/sounds/moods/good.mp3" preload="auto"></audio>
  <audio id="sound-neutral" src="assets/sounds/moods/neutral.mp3" preload="auto"></audio>
  <audio id="sound-sad" src="assets/sounds/moods/sad.mp3" preload="auto"></audio>
  <audio id="sound-very-sad" src="assets/sounds/moods/very-sad.mp3" preload="auto"></audio>

  <div id="emojiList" class="emoji-list"></div>
  <div id="confetti" class="confetti"></div>

  <script>
    const moods = [
      { image: '0.crying.png', points: -3 },
      { image: '1.sad.png', points: -2 },
      { image: '2.meh.png', points: 1 },
      { image: '2.okay.png', points: 1 },
      { image: '3.love.png', points: 3 }
    ];
    const imagePath = 'assets/moods/';

    const table = document.getElementById('taskTable');
    const weeklyPoints = document.getElementById('weeklyPoints');

    function loadFromStorage() {
      const data = JSON.parse(localStorage.getItem('lauraBoard') || '{}');
      for (let i = 1; i < table.rows.length - 1; i++) {
        for (let j = 1; j < table.rows[i].cells.length; j++) {
          const key = `cell-${i}-${j}`;
          table.rows[i].cells[j].innerHTML = '';
          if (data[key]) {
            const img = document.createElement('img');
            img.src = imagePath + data[key];
            table.rows[i].cells[j].appendChild(img);
          }
        }
      }
      updatePoints();
    }

    function saveToStorage() {
      const data = {};
      for (let i = 1; i < table.rows.length - 1; i++) {
        for (let j = 1; j < table.rows[i].cells.length; j++) {
          const key = `cell-${i}-${j}`;
          const img = table.rows[i].cells[j].querySelector('img');
          data[key] = img ? img.src.split('/').pop() : '';
        }
      }
      localStorage.setItem('lauraBoard', JSON.stringify(data));
      updatePoints();
    }

    function updatePoints() {
      let total = 0;
      let dailyTotals = [0, 0, 0, 0, 0, 0, 0];
      for (let i = 1; i < table.rows.length - 1; i++) {
        for (let j = 1; j <= 7; j++) {
          const img = table.rows[i].cells[j].querySelector('img');
          if (img) {
            const mood = moods.find(m => m.image === img.src.split('/').pop());
            if (mood) {
              total += mood.points;
              dailyTotals[j - 1] += mood.points;
            }
          }
        }
      }
      weeklyPoints.textContent = total;
      dailyTotals.forEach((val, idx) => {
        const cell = document.getElementById(`dp-${idx + 1}`);
        cell.textContent = val;
        cell.classList.add('highlight');
        setTimeout(() => cell.classList.remove('highlight'), 600);
      });
    }

    function playSound(moodImage) {
      try {
        const allSounds = [
          document.getElementById('sound-happy'),
          document.getElementById('sound-good'),
          document.getElementById('sound-neutral'),
          document.getElementById('sound-sad'),
          document.getElementById('sound-very-sad')
        ];
        
        allSounds.forEach(sound => {
          if (sound) {
            sound.pause();
            sound.currentTime = 0;
          }
        });

        let sound;
        switch(moodImage) {
          case '3.love.png':
            sound = document.getElementById('sound-happy');
            break;
          case '2.okay.png':
            sound = document.getElementById('sound-good');
            break;
          case '2.meh.png':
            sound = document.getElementById('sound-neutral');
            break;
          case '1.sad.png':
            sound = document.getElementById('sound-sad');
            break;
          case '0.crying.png':
            sound = document.getElementById('sound-very-sad');
            break;
        }
        if (sound) {
          sound.play().catch(() => {});
        }
      } catch (e) {}
    }

    function showEmojiList(cell) {
      const emojiList = document.getElementById('emojiList');
      emojiList.innerHTML = '';
      moods.forEach(mood => {
        const img = document.createElement('img');
        img.src = imagePath + mood.image;
        img.onclick = () => {
          cell.innerHTML = '';
          const newImg = document.createElement('img');
          newImg.src = imagePath + mood.image;
          newImg.classList.add('pop');
          cell.appendChild(newImg);
          playSound(mood.image);
          saveToStorage();
          emojiList.classList.remove('open');
          // Confete se for o mais feliz
          if (mood.image === '3.love.png') {
            launchConfetti();
          }
        };
        emojiList.appendChild(img);
      });
      const rect = cell.getBoundingClientRect();
      emojiList.style.left = rect.left + 'px';
      emojiList.style.top = rect.bottom + 'px';
      emojiList.classList.add('open');
    }

    // Fechar a lista quando clicar fora
    document.addEventListener('click', function(e) {
      const emojiList = document.getElementById('emojiList');
      if (!emojiList.contains(e.target) && !e.target.closest('td')) {
        emojiList.classList.remove('open');
      }
    });

    table.addEventListener('click', function (e) {
      const cell = e.target.closest('td');
      if (cell && cell.cellIndex > 0 && cell.parentElement.rowIndex < table.rows.length - 1) {
        showEmojiList(cell);
      }
    });

    function resetBoard() {
      if (confirm('Deseja limpar o quadro da semana?')) {
        for (let i = 1; i < table.rows.length - 1; i++) {
          for (let j = 1; j < table.rows[i].cells.length; j++) {
            table.rows[i].cells[j].innerHTML = '';
          }
        }
        saveToStorage();
      }
    }

    function exportData() {
      const data = JSON.stringify(localStorage.getItem('lauraBoard'), null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'laura_board.json';
      link.click();
    }

    // Confete simples
    function launchConfetti() {
      const confetti = document.getElementById('confetti');
      confetti.innerHTML = '';
      const colors = ['#ffb6b9', '#fcd5ce', '#cdb4db', '#b5ead7', '#f9f871', '#a0c4ff', '#ffd6a5'];
      const num = 40;
      for (let i = 0; i < num; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        piece.style.left = Math.random() * 100 + 'vw';
        piece.style.top = '-20px';
        piece.style.transform = `rotate(${Math.random()*360}deg)`;
        piece.style.transition = `top 1.2s cubic-bezier(.4,2,.6,1), left 1.2s`;
        confetti.appendChild(piece);
        setTimeout(() => {
          piece.style.top = 80 + 10*Math.random() + 'vh';
          piece.style.left = (parseFloat(piece.style.left) + (Math.random()-0.5)*100) + 'vw';
        }, 10);
      }
      setTimeout(() => { confetti.innerHTML = ''; }, 1600);
    }

    loadFromStorage();
  </script>
  <script>
    // Tratamento global de erros
    window.addEventListener('error', function(e) {
      if (e.message && e.message.includes('runtime.lastError')) {
        e.preventDefault();
        e.stopPropagation();
        return true;
      }
    }, true);
  </script>
</body>
</html>
